{% extends "base.html" %}

{% block title %}Ventas de Productos{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>üõçÔ∏è Ventas de Productos</h2>
        <p class="text-muted">Gestiona las ventas de productos de la barber√≠a</p>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-4 mb-4">
        <div class="card bg-info text-white">
            <div class="card-body text-center">
                <h5>üí∞ Hoy</h5>
                <h3>S/.{{ "%.2f"|format(today_total) }}</h3>
                <small>Ventas del d√≠a de hoy</small>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <h5>üìà Este Mes</h5>
                <h3>S/.{{ "%.2f"|format(month_total) }}</h3>
                <small>Ventas del mes actual</small>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card bg-warning text-dark">
            <div class="card-body text-center">
                <h5>üõí Total Ventas</h5>
                <h3>{{ product_sales|length }}</h3>
                <small>Registros de ventas</small>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">‚ûï Registrar Venta de Producto</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="date_sale" class="form-label">üìÖ Fecha de venta:</label>
                        <input type="date" class="form-control" id="date_sale" name="date_sale" 
                               value="{{ current_date }}" required>
                    </div>

                    <div class="mb-3">
                        <label for="product_name" class="form-label">üõçÔ∏è Nombre del producto:</label>
                        <input type="text" class="form-control" id="product_name" name="product_name" 
                               placeholder="Ej: Gel, Pomada, Shampoo, etc." required>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="price" class="form-label">üí∞ Precio unitario:</label>
                                <input type="number" step="0.01" class="form-control" id="price" name="price" 
                                       placeholder="Ej: 25.00" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="quantity" class="form-label">üî¢ Cantidad:</label>
                                <input type="number" class="form-control" id="quantity" name="quantity" 
                                       value="1" min="1" required>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 p-3 bg-light rounded">
                        <h6>üìä Resumen autom√°tico:</h6>
                        <p><strong>Total venta:</strong> <span id="total-preview">S/.0.00</span></p>
                    </div>

                    <button type="submit" class="btn btn-success w-100">üíæ Guardar Venta</button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üìã Historial de Ventas</h5>
            </div>
            <div class="card-body">
                {% if product_sales %}
                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Producto</th>
                                <th>Precio</th>
                                <th>Cant</th>
                                <th>Total</th>
                                <th>Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sale in product_sales %}
                            <tr>
                                <td>{{ sale.date_sale.strftime('%d/%m/%Y') }}</td>
                                <td>{{ sale.product_name }}</td>
                                <td>S/.{{ "%.2f"|format(sale.price) }}</td>
                                <td>{{ sale.quantity }}</td>
                                <td>S/.{{ "%.2f"|format(sale.total) }}</td>
                                <td>
                                    <a href="{{ url_for('delete_product_sale', sale_id=sale.id) }}" 
                                       class="btn btn-sm btn-outline-danger"
                                       onclick="return confirm('¬øEst√°s seguro de eliminar esta venta?')">
                                        üóëÔ∏è
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">No hay ventas de productos registradas.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">‚Üê Volver al Dashboard</a>
    </div>
</div>

<script>
    function calculateTotal() {
        const price = parseFloat(document.getElementById('price').value) || 0;
        const quantity = parseInt(document.getElementById('quantity').value) || 0;
        const total = price * quantity;

        document.getElementById('total-preview').textContent = 'S/.' + total.toFixed(2);
    }

    document.getElementById('price').addEventListener('input', calculateTotal);
    document.getElementById('quantity').addEventListener('input', calculateTotal);

    calculateTotal();
</script>
{% endblock %}